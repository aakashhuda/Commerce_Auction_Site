{% extends "auctions/layout.html" %}
{% block title %}
    {{title}}
{% endblock %}

{% block body %}
    {% if message %}
        <div class="alert alert-primary" role="alert">
            {{message}}
        </div>
    {% endif %}
    {% if no_item_message %}
        <p>{{title}},{{no_item_message}}</p>
    {% else %}
        <div>
            <p>Title: {{listing.title}}</p>
            <p>Description: {{listing.text}}</p>
            <p>Base bid: {{listing.bs_bid}}</p>
            <p>Listing Owner: {{listing.owner.username}}</p>
            {% if request.user in listing.watchlist.all %}
                <p>In the list</p>
            {% endif %}
            {% if hs_bid %}
                <p>Highest Bid: {{hs_bid.amount}}</p>
                <p>Highest Bidder: {{hs_bid.user}}</p>
            {% else %}
                <p>You'll be the first to bid</p>    
            {% endif %}
            {% if user.is_authenticated %}
                <form action="{% url 'auctions:post_bid' %}" method="POST">
                    {% csrf_token %}
                    <div class="fieldWrapper mb-3">
                        {{ form.amount.errors }}
                        {{ form.amount.label_tag }}
                        {{ form.amount }}
                    </div>
                    {% if request.user in listing.watchlist.all %}
                        <div class="fieldWrapper mb-3">
                            {{ form.remove_watchlist.errors }}
                            {{ form.remove_watchlist.label_tag }}
                            {{ form.remove_watchlist }}
                        </div>
                    {% else %}
                    <div class="fieldWrapper mb-3">
                        {{ form.watchlist.errors }}
                        {{ form.watchlist.label_tag }}
                        {{ form.watchlist }}
                    </div>
                    {% endif %}
                    
                    <input type="hidden" name="listing_info" value="{{listing}}">
                    {% if listing.owner == request.user %}
                        {{listing_form.as_p}}
                    {% else %}
                        <input type="hidden" name="active" id="id_active" value="{{listing.active}}">
                    {% endif %}
                    <input type="submit" value="submit">
                </form>
            {% endif %}
        </div>
    {% endif %}

{% endblock %}


            